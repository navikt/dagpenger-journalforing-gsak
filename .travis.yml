language: java
jdk:
- openjdk11
env:
  global:
  - VERSION=$(git rev-parse --short HEAD)
  - GITHUB_APP_ID=21626
  - DOCKER_USERNAME=naviktdocker
  - secure: SspRZ8EaUnTNaeC9wooufNmJ0Iia14GiTHK1l+EFq6yzmvNL/QAdmgl/5/uYwjsc2CN2YJen+i4HhuSNogrpUC5OQZaXCP/CJOAZsEGbrUnEwvAiiNiov0rN5TC0yaghkvsVsUdCgAUGLR6XLsh+ucyyPwnxXUiCV7TKYYhzoqsZ3K1n7udaGp7kd2ghS1YL0Vw3a2b5921PKdf/qy9Z1WE35VQmCBckCB58tC9VJYXIGVM0jEWDC31XNCLMxoe1e7svSn1hLxVgC2hN19BV1QSm+5ntTmMygrLdZhdimEZsEZYb2o2AFo+XkI6YtY1L+O58eShTPmgOXeByOdJKGXVQGzU1ngptfwhl40LPuzw8IfYUPVyKGcxVB2D2ak2tBt9n3zQ8iKdBqtpxgwqBarcpwZThGzU9E8oHl9NxLaXgfPjKlp68TxhPhF0u3/f2oIkEGG/+HwBhsOSUQ2knLuzHIu8oCUSClmwFlYJ/nMzy1NVEOmQ0Vqqk8kO80jTIr9J2agbLryFmvgxJh+AD4uwBJuboJr8pDqe9u23bkwECTjPnUi0toYp3RBh8yBC2gRAHsboJJE/kyxyODt2rWzP8u4wGU7xAGtPxlAd/rXJ6VyECh6DdcRxwxNsC30SrQfxAQ2pIY2AQwvnBmFdDVKq6Vre57H5E19G5kfeBH58=
before_install:
  - openssl aes-256-cbc -K $encrypted_8baa07224b9d_key -iv $encrypted_8baa07224b9d_iv -in travis/team-dagpenger.private-key.pem.enc -out travis/team-dagpenger.private-key.pem -d
- git clone https://github.com/navikt/github-apps-support.git
- export PATH=`pwd`/github-apps-support/bin:$PATH
  - export GH_TOKEN=$(generate-installation-token.sh `generate-jwt.sh ./travis/team-dagpenger.private-key.pem $GITHUB_APP_ID`)
stages:
- Tests
- Deploy
jobs:
  include:
  - stage: Tests
    script: "./gradlew check --info"
  - stage: Deploy
    if: branch = master
    script: skip
    deploy:
      provider: script
      script: travis/deploy.sh
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
notifications:
  slack:
    rooms:
      secure: KuTM77V+5dJdVqH4Gks6cAekw75pGv9bLgokNY+h3yHmeRVfz9rZb/jZJykO4Txzy20UaBRisXjfjv6zxNt/MNRCLdZaBNUHMjvdyucI7AWTKCXd71OqvOuOybR6MeyHSxyyOjuKZClXIqmAnvPwLQ1iAc3zmjYQMaylKeIqVxRfl9C1Bl2R+vGf+nGMKyGy8tydjuqhibeHIV43synJqcFIGV3+WEUYFMKtKv+mRmDjdzDejxeeLqoKFdE1ZlKJZHLHe7SUDe/aBBAmoAoAWROarclbpnDC+mvqIIDCQRO5PuZcxNzEk67AyXmwG81vS6nrRmWIqzE3tOiCsBCsZt9Jy3ndrewVecltIIUYTtcisgs7CtM6Wo99WYI0+V2iRJLsLrcmBIdx3FF4aTgc7vOw/7IN3D4oZ4zfpsWERaMIcpUmJuUZZ83urwGV5lqOe3HXeZsnMzmLLoSwwk6zAwxxL0Flf2Dbl25aY3YEkrosGgPdSSueoftOl8ZUExNGGJ4tR1S75lRClXCDA3SYILTfC2khc6CQtFuMia7X4oh1UfS9g9is3eSqGqRpmh+oKtKoSg9I+I3q2NrD12Z39RVj+KP08UDW5KmKkD2YSMz2hAfZvaUSDnypr7Yxi/SvU0xZkI9S88R6LEfKDAOOjGtvUI9uYG37ACPDU5WFbEg=
  on_pull_requests: false
